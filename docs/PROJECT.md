# Документация проекта

## Обзор системы
LE Pricer помогает игрокам Last Epoch быстро оценивать предметы. Приложение состоит из трёх ключевых компонентов:

1. **GUI (`gui.MainWindow`)** — основное окно PySide6. Позволяет редактировать базу цен, управлять горячими клавишами и инициировать захват шаблонов.
2. **Worker (`worker.OCRWorker`)** — фоновый объект Qt, который слушает глобальные горячие клавиши, захватывает экран и сопоставляет подсказку с шаблонами. В нынешней версии OCR отсутствует: всё завязано на шаблонном распознавании и данные из базы.
3. **Overlay (`overlay.PriceOverlay`)** — всегда поверх всех окон. Получает сигналы от воркера и показывает текстовые подсказки в игре.

## Основные сценарии
### Оценка предмета
1. Пользователь нажимает горячую клавишу (по умолчанию `F1`).
2. `OCRWorker` захватывает весь экран и определяет координаты подсказки по угловым шаблонам.
3. Модуль `template_manager` возвращает наилучшее совпадение по имени предмета. Дополнительно определяется легендарный потенциал с помощью глобальных шаблонов `1lp.png`–`4lp.png`.
4. `PriceDB` ищет цену и комментарии, после чего воркер отправляет сигнал `boxReady` в оверлей.
5. Оверлей отображает две строки: название предмета (с ЛП, если найден) и цену либо пометку о её отсутствии.

Если шаблон не найден, воркер сразу открывает диалог захвата нового образца и выводит статус «Шаблон не найден — откроется окно создания шаблона».

### Захват шаблона
- Запускается кнопкой в GUI или горячей клавишей (по умолчанию `F3`).
- `OCRWorker` делает скриншот, сохраняет его в `logs/` и передаёт пути в GUI.
- Пользователь выделяет рамку, выбирает предмет из списка и сохраняет шаблон через `template_manager`.

### Управление базой цен
- Таблица «Цены» в GUI позволяет редактировать записи и добавлять новые строки.
- Все изменения сохраняются в `prices.json`. Файл обновляется под блокировкой, чтобы избежать конфликтов при одновременных операциях.

## Конфигурация и сохранение
- Настройки (горячие клавиши, параметры оверлея) читаются и сохраняются через `config.py` в `%APPDATA%/Pricer` (Windows) или `~/.local/share/pricer` (Linux).
- Шаблоны и логи хранятся рядом с исполняемым файлом; они игнорируются Git-репозиторием.

## Обработка ошибок
- Воркер сообщает о каждом шаге через сигнал `status`, чтобы GUI показывал понятные сообщения.
- Исключения логируются и приводят к уведомлению «Ошибка обработки» в оверлее, но не блокируют приложение.
- При отсутствии шаблона пользователю сразу предлагается его создать — нет попыток распознавать текст.

## Советы по разработке
- Поддерживайте Python 3.12+: это зафиксировано в `main.MIN_PYTHON`.
- Используйте типы и мелкие функции-хелперы, чтобы не перегружать GUI-слой.
- Новые тесты размещайте в `tests/`, придерживаясь схемы `test_<module>.py`.
- При отладке включайте сохранение диагностических кадров (`debugImgCheck`) — они помогают анализировать совпадение шаблонов.

## Чек-лист перед релизом
- Переснять угловые шаблоны на целевой машине и убедиться, что рамка находится стабильно.
- Очистить `logs/` перед упаковкой сборки.
- Обновить `CHANGELOG.md` и `VERSION`.
- Проверить, что скрипты в `scripts/` успешно запускают приложение и сборку без упоминаний Tesseract.

## Лицензия
Проект распространяется под лицензией MIT (если файл `LICENSE` приложен к релизу).
