# LE Pricer

Настольное приложение для игроков Last Epoch. Оно слушает глобальные горячие клавиши, делает снимок области подсказки предмета, сопоставляет её с сохранёнными шаблонами и показывает цену из локальной базы прямо поверх игры.

## Основные возможности
- Захват экрана и распознавание рамки подсказки по заранее снятым шаблонам без использования OCR.
- Автоматический поиск цены в локальной базе `prices.json` с учётом легендарного потенциала.
- Настраиваемые горячие клавиши для оценки предмета, сканирования инвентаря и ручного снятия новых шаблонов.
- Интерактивный GUI на PySide6 для редактирования цен и управления шаблонами.
- Оверлей, который отображает подсказку с ценой и данными по ЛП, не блокируя игру.

## Требования
- Python 3.12 или новее (`python --version`).
- Windows 10/11 или Linux с поддержкой PySide6 и OpenCV.

## Установка
```powershell
python -m venv .venv
.venv\Scripts\python -m pip install --upgrade pip
.venv\Scripts\python -m pip install -r requirements.txt
```
На macOS/Linux замените вторую строку на `source .venv/bin/activate`.

## Первый запуск
```powershell
python main.py
```
Откроется главное окно. Проверьте горячие клавиши и, при необходимости, переснимите шаблоны рамки подсказки (кнопка/горячая клавиша по умолчанию `F3`).

## Горячие клавиши по умолчанию
- `F1` — определить текущий предмет и показать оверлей.
- `F2` — просканировать инвентарь и вывести подсказки по найденным предметам.
- `F3` — запустить диалог захвата шаблона.

Горячие клавиши можно менять в верхней панели окна; изменения применяются немедленно.

## Структура проекта
- `main.py` — точка входа, соединяет GUI, рабочий поток и оверлей.
- `gui.py` — главное окно PySide6 с таблицами цен и управлением шаблонами.
- `worker.py` — фоновой поток, слушает горячие клавиши и обрабатывает скриншоты.
- `ocr.py` — вспомогательные функции захвата экрана и обнаружения рамки (только шаблоны, без OCR).
- `overlay.py` — виджет оверлея с подсказками.
- `db.py` — работа с JSON-базой цен.
- `template_manager.py` — менеджер шаблонов предметов и ЛП.
- `prices.json` — пример базы для тестов.
- `tests/` — автотесты на pytest.

## Разработка
- Линтер: `ruff .` или `flake8 .`.
- Форматирование: `ruff format .` или `black .`.
- Тесты: `pytest -q`.
- Логи пишутся в `logs/app.log`; при необходимости удалите папку, чтобы очистить историю.

## Решение проблем
- **Горячие клавиши не работают.** Запустите приложение от имени администратора и убедитесь, что другие программы не перехватывают те же комбинации.
- **Шаблон не находится.** Снимите новый шаблон рамки (`F3`) и проверьте, что изображение предмета чёткое.
- **Оверлей не виден.** Переключите игру в оконный или пограничный режим, чтобы оверлей мог отрисоваться поверх.
- **Цена не найдена.** Убедитесь, что предмет есть в `prices.json`, или добавьте его вручную через таблицу «Цены».

## ЧаВо
**Как изменить горячие клавиши?** Введите нужные значения в полях верхней панели — изменения применяются сразу.

**Как переснять шаблон?** Нажмите `F3` (или выбранную горячую клавишу). В открывшемся окне выделите рамку подсказки предмета и выберите имя из списка.

**Можно ли использовать приложение без окна?** Да. Оставьте приложение свёрнутым: фоновой поток продолжит слушать горячие клавиши и показывать оверлей.

## Лицензия
Проект распространяется под лицензией MIT. Если в релиз входит файл `LICENSE`, изучите его перед распространением.
